<!DOCTYPE html>
<html lang="en">
<title>utternace tester</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://unpkg.com/tachyons/css/tachyons.min.css">
<!-- <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script> -->
<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<script src="js/bundle.js"></script>
<style>
  .container {
    display: inline-grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr;
    grid-template-areas:
      "left right"
  }
</style>

<body>

  <body class="pl4 bg-light-gray">
    <h1 class="navy">alexa-utterances</h1>
    <article id="app" class="container w-100 pa4 black-80">
      <div class="pa2">
        <label class="f4 dib mb-3">dictionary</label>
        <div class="db">
          <input type="text" class="input-reset f6 bn black-80 bg-white pa3 lh-solid w-75 br2-ns br--left-ns"
            placeholder="add dictionary name" v-model=dictionaryKey />
          <input type="text" class="input-reset f6 bn black-80 bg-white pa3 lh-solid w-75 br2-ns br--left-ns"
            placeholder="add dictionary items (comma separated)" v-model="dictionaryValue" />
          <button type="button"
            class="button-reset f6 bn tc bg-animate bg-dark-green hover-bg-green white pointer pv3 br2-ns ph3 br--right-ns"
            v-on:click="addTo('dictionary')">add</button>
        </div>
      </div>
      <div class="pa2">
        <ul class="list bg-white pl0 ml0 mw6 ba b--light-silver br3" v-if="Object.keys(dictionary).length">
          <todo-item v-for="item in prettyDictionary" v-bind:todo="item" :key="item.id"
            @delete="onDeleteItem('dictionary', $event)">
          </todo-item>
        </ul>
      </div>
      <div class="pa2">
        <label class="f4 dib mb-3">templates</label>
        <div class="db">
          <input type="text" class="input-reset f6 bn black-80 bg-white pa3 lh-solid w-75 br2-ns br--left-ns"
            placeholder="add template string" v-model="template" v-on:keyup.enter="addTo('template')" />
          <button type="button"
            class="button-reset f6 bn tc bg-animate bg-dark-green hover-bg-green white pointer pv3 br2-ns ph3 br--right-ns"
            v-on:click="addTo('template')">add</button>
        </div>
      </div>
      <div class="pa2">
        <ul class="list bg-white pl0 ml0 mw6 ba b--light-silver br3" v-if="templates.length">
          <todo-item v-for="item in templates" v-bind:todo="item" :key="item.id"
            @delete="onDeleteItem('template', $event)">
          </todo-item>
        </ul>
      </div>
      <div class="pa2">
        <button v-on:click="generate" type="button"
          class="button-reset ph3 pv2 f6 white fw1 small-caps tracked-mega bg-blue hover-bg-dark-blue pointer br2 bn">Generate</button>
      </div>
      <div class="pa2">
        <ul class="list bg-white pl0 ml0 mw6 ba b--light-silver br3" v-if="output.length">
          <li class="ph3 pv3 bb b--light-silver" v-for="item in output">
            {{ item }}
          </li>
        </ul>
      </div>
    </article>
  </body>
  <script>
    Vue.component('todo-item', {
      props: ['todo'],
      template: `<li class="ph3 pv2 bb b--light-silver">{{ displayText }}
          <button v-on:click="$emit('delete', todo)" class="fr bg-white ba1 b--silver red code pt0" type="button">x</button>
        </li>`,
      computed: {
        displayText(obj) {
          if (obj.todo.text) {
            return obj.todo.text;
          }

          console.log(obj);
        }
      }
    });

    Vue.component('')

    const app = new Vue({
      el: '#app',
      data: {
        slot: '',
        slots: [],
        template: '',
        templates: [],
        dictionaryValue: '',
        dictionaryKey: '',
        dictionaries: [],
        dictionary: {},
        output: [],
        index: 0
      },
      computed: {
        // a computed getter
        prettyDictionary() {
          // `this` points to the vm instance

          return Object.keys(this.dictionary).map(key => {
            return {
              id: key,
              text: `${key}: ${this.dictionary[key]}`
            }
          });
        }
      },
      methods: {
        generate() {
          this.output = [];

          this.templates.forEach(item => {
            this.output = this.output.concat(window.utterances(item.text, {}, this.dictionary));
          });
        },
        onDeleteItem(filter, input) {
          if (filter === 'template') {
            this.templates = this.templates.filter(item => item.id !== input.id);
            return;
          } else if (filter === 'dictionary') {
            Vue.delete(this.dictionary, input.id);
          }
        },
        addTo(place) {
          if (place === 'dictionary') {
            if (!this.dictionaryValue || !this.dictionaryKey) {
              return;
            }
            this.dictionary[this.dictionaryKey] = this.dictionaryValue.replace(/[\'\"\‘\’\“\”\[\]]/g, '').split(',');
            this.dictionaries.push({ id: this.dictionaryKey, text: this.dictionaryValue });

            this.dictionaryKey = '';
            this.dictionaryValue = '';
          } else if (place === 'template') {
            if (!this.template) {
              return;
            }
            this.templates.push({ id: this.index, text: this.template });
            this.index = this.index + 1;
            this.template = '';
          }
        }
      }
    });
  </script>

</html>
